# IoT Anomaly Alerts

Система мониторинга IoT-сенсоров, которая собирает, анализирует и визуализирует данные в реальном времени. Проект эмулирует работу IoT-системы мониторинга, которая:
- Собирает данные с виртуальных сенсоров (температура, давление и т.д.)
- Отправляет их через Kafka
- Обрабатывает и анализирует на аномалии
- Выдаёт данные через gRPC-сервер
- Отдаёт метрики Prometheus для мониторинга в Grafana

## Архитектура

### Компоненты системы

| Компонент               | Назначение                                                             |
| ----------------------- | ---------------------------------------------------------------------- |
| **SensorSimulator**     | Генерирует фейковые данные сенсора (например, `temp = 36.5`)           |
| **KafkaProducer**       | Отправляет эти данные в Kafka (topic: `sensor-data`)                   |
| **KafkaConsumer**       | Читает данные из Kafka и проверяет их на аномалии                      |
| **AnomalyDetector**     | (внутри Consumer'а) Логика проверки порогов (например, `temp > 40.0`)  |
| **gRPC Server**         | Выдаёт: список последних показаний и список аномалий                   |
| **Prometheus Exporter** | Отдаёт метрики для Prometheus (например, количество аномалий в минуту) |
| **Grafana Dashboard**   | Визуализирует метрики и события                                        |

### Технологический стек

| Технология         | Зачем нужна                       |
| ------------------ | --------------------------------- |
| **C++20**          | Основной язык реализации          |
| **Kafka**          | Передача сообщений между модулями |
| **cppkafka**       | Kafka-клиент на C++               |
| **gRPC**           | Сетевой сервер/клиент             |
| **Protobuf**       | Описание gRPC API                 |
| **Prometheus-cpp** | Экспорт метрик                    |
| **Grafana**        | Панель мониторинга                |
| **CMake**          | Сборка проекта                    |
| **Docker**         | Контейнеризация и развертывание   |

## Структура проекта

```
.
├── src/                    # Исходный код
├── include/               # Заголовочные файлы
├── config/               # Конфигурационные файлы
│   ├── kafka/           # Конфигурация Kafka
│   ├── prometheus/      # Конфигурация Prometheus
│   └── grafana/         # Конфигурация Grafana
├── build/               # Директория сборки
├── Dockerfile          # Конфигурация Docker для основного приложения
├── docker-compose.yml  # Конфигурация всех сервисов
└── CMakeLists.txt      # Конфигурация сборки
```

## Установка и запуск

### Требования
- Docker
- Docker Compose

### Быстрый старт

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd AnomalyAlert
```

2. Запустите все сервисы:
```bash
docker-compose up --build
```

3. Доступ к сервисам:
- Grafana Dashboard: http://localhost:3000 (admin/admin)
- Prometheus: http://localhost:9090
- gRPC Server: localhost:50051
- Kafka: localhost:9092
- Zookeeper: localhost:2181

### Разработка

Для пересборки приложения после изменений:
```bash
docker-compose build anomaly-alert
docker-compose up -d anomaly-alert
```

## Пример сценария работы

1. Температура > 50°C
2. SensorSimulator генерирует temp = 53.2
3. Producer отправляет сообщение в Kafka
4. Consumer получает сообщение, обнаруживает превышение порога
5. Фиксирует аномалию [ALERT]
6. gRPC сервер возвращает её по /GetAnomalies
7. Prometheus фиксирует "обнаружена аномалия"
8. Grafana отображает график пиков

## Мониторинг

### Prometheus
- Собирает метрики каждые 15 секунд
- Доступен по адресу: http://localhost:9090
- Основные метрики:
  - Количество аномалий
  - Время обработки сообщений
  - Статус соединения с Kafka

### Grafana
- Визуализация метрик
- Доступна по адресу: http://localhost:3000
- Предустановленные дашборды:
  - Общий обзор системы
  - График аномалий
  - Статус сервисов
